# コード検証システム（Self-Lint基本）

**概要**: マクロ実行前にセキュリティ・構文・品質の基本チェックを自動実行する自己検証システム。問題検出時は実行停止し、修正提案を行う予防的品質管理の実践。

---

## 完全初期化（クリーンスタート）

全ての変数をクリアしてください
TODOリストをすべてクリアしてください

「=== コード検証システム開始 ===」と表示してください。

## 検証ルールの設定

以下の構造をvariables.jsonに作成してください：

```json
{
  "target_macro": "",
  "lint_result": {},
  "verification_log": []
}
```

**重要**: 以降のコード検証では、以下のルールを自動適用してください：

**1. セキュリティチェック**: 危険なコマンド（rm、sudo、chmod等）の検出
**2. 変数整合性**: 未定義変数参照や循環参照の確認  
**3. エラーハンドリング**: Try-Catch、Human-in-the-Loop等の安全機構の有無

## フェーズ1: 検証対象マクロの設定

### 問題を含むマクロ例の提示

以下のマクロを{{target_macro}}に保存してください：

```markdown
## 危険なファイル処理マクロ（検証用）
sudo rm -rf {{user_folder}}/* を実行してください。
{{undefined_variable}}の値を表示してください。
外部APIから{{secret_key}}でデータを取得してください。
```

### 検証対象の確認

{{target_macro}}の内容を表示してください

## フェーズ2: 自動検証の実行

### セキュリティ・構文・品質チェック

上記{{target_macro}}に対して宣言した検証ルールを適用し、以下の形式で{{lint_result}}に保存してください：

```json
{
  "security_issues": ["検出されたセキュリティ問題のリスト"],
  "syntax_issues": ["検出された構文問題のリスト"], 
  "quality_issues": ["検出された品質問題のリスト"],
  "severity": "error|warning|info",
  "safe_to_proceed": false,
  "recommended_fixes": ["修正提案のリスト"]
}
```

### 検証ログの記録

検証プロセスを{{verification_log}}に記録してください：
- 各チェック項目の実行状況
- 問題検出の詳細
- 判定根拠

## フェーズ3: 結果判定と対応

### 条件分岐による実行制御

{{lint_result}}のsafe_to_proceedに応じて：

**safe_to_proceedがfalseの場合**：
- 「⚠️ 検証エラー: マクロ実行を停止します」を表示
- {{lint_result}}の問題詳細を表示
- 修正提案を表示

**safe_to_proceedがtrueの場合**：
- 「✅ 検証完了: マクロは実行可能です」を表示

### 検証結果の表示

「=== 検証結果レポート ===」として以下を表示：
1. 検出された問題の詳細
2. 重要度判定の根拠
3. 推奨修正アクション
