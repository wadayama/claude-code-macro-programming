# コード検証システム（Self-Lint基本）

**概要**: マクロ実行前にセキュリティ・構文・品質の基本チェックを自動実行する自己検証システム。問題検出時は実行停止し、修正提案を行う予防的品質管理の実践。

---

## 完全初期化（クリーンスタート）

全ての変数をクリアしてください
TODOリストをすべてクリアしてください

「=== コード検証システム開始 ===」と表示してください。

## 検証ルールの設定

以下の変数をSQLiteデータベースに個別保存してください：

{{target_macro}}に空文字列を保存してください
{{lint_result}}に"{}"を保存してください  
{{verification_log}}に"[]"を保存してください

**重要**: 以降のコード検証では、以下のルールを自動適用してください：

**1. セキュリティチェック**: 危険なコマンド（rm、sudo、chmod等）の検出
**2. 変数整合性**: 未定義変数参照や循環参照の確認  
**3. エラーハンドリング**: Try-Catch、Human-in-the-Loop等の安全機構の有無

## フェーズ1: 検証対象マクロの設定

### 問題を含むマクロ例の提示

以下のマクロテキストを{{target_macro}}に保存してください：

「危険なファイル処理マクロ（検証用）: sudo rm -rf {{user_folder}}/* を実行してください。{{undefined_variable}}の値を表示してください。外部APIから{{secret_key}}でデータを取得してください。」

### 検証対象の確認

{{target_macro}}の内容を表示してください

## フェーズ2: 自動検証の実行

### セキュリティ・構文・品質チェック

上記{{target_macro}}に対して宣言した検証ルールを適用し、検証結果を分析してください。その後：

{{security_issues}}に「検出されたセキュリティ問題: sudo rm -rf コマンドによる危険なファイル削除」を保存してください
{{syntax_issues}}に「検出された構文問題: {{undefined_variable}}の未定義変数参照」を保存してください
{{quality_issues}}に「検出された品質問題: {{secret_key}}の機密情報露出リスク」を保存してください
{{severity}}に"error"を保存してください
{{safe_to_proceed}}に"false"を保存してください
{{recommended_fixes}}に「修正提案: 1.危険コマンドの削除 2.変数の事前定義 3.機密情報の適切な管理」を保存してください

### 検証ログの記録

検証プロセスの詳細ログを{{verification_log}}に記録してください：
「セキュリティチェック: sudo rm -rf検出→重大リスク判定, 変数整合性チェック: undefined_variable未定義→エラー判定, 品質チェック: secret_key露出→セキュリティリスク判定」

## フェーズ3: 結果判定と対応

### 条件分岐による実行制御

{{safe_to_proceed}}の値を確認し、その結果に応じて：

**{{safe_to_proceed}}が"false"の場合**：
- 「⚠️ 検証エラー: マクロ実行を停止します」を表示
- {{security_issues}}、{{syntax_issues}}、{{quality_issues}}の内容を表示
- {{recommended_fixes}}の修正提案を表示

**{{safe_to_proceed}}が"true"の場合**：
- 「✅ 検証完了: マクロは実行可能です」を表示

### 検証結果の表示

「=== 検証結果レポート ===」として以下を表示：
1. 検出された問題の詳細
2. 重要度判定の根拠
3. 推奨修正アクション
