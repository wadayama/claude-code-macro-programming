# 🎯 アンサンブル要約システム - 嘘検出機能付き

## システム初期化

「=== アンサンブル要約システム開始 ===」と表示してください。

## 完全初期化（クリーンスタート）

全ての変数をクリアしてください。

「全ての変数をクリアしました」と表示してください。

## 設定パラメータ

{{lie_probability}}に0.3を保存してください。

「嘘つき確率: {{lie_probability}}（40%）に設定しました」と表示してください。

## 入力データ読み込み

sample_article.mdファイルを読み込んでください。

読み込んだ内容を{{input_text}}に保存してください。

「入力テキストを{{input_text}}に保存しました」と表示してください。

## マルチエージェント要約実行

**⚠️ 重要**: summarizer_agent.mdファイルは読み取り専用です。内容を読み込むことはできますが、絶対に書き換えてはいけません。必ずagents/フォルダ内の新しいファイルに保存してください。

agents/フォルダを作成してください：
```bash
mkdir -p agents
```

**Task toolを利用して3つのエージェントプロセスを並列起動してください：**

### Task 1: エージェント1実行
1. summarizer_agent.mdの内容を読み取り、すべての<<ID>>を"1"に置換してagents/summarizer_agent_1.mdに保存してください
2. 次に以下のコマンドを実行してください：
   ```bash
   cat agents/summarizer_agent_1.md | claude -p --dangerously-skip-permissions
   ```

### Task 2: エージェント2実行
1. summarizer_agent.mdの内容を読み取り、すべての<<ID>>を"2"に置換してagents/summarizer_agent_2.mdに保存してください
2. 次に以下のコマンドを実行してください：
   ```bash
   cat agents/summarizer_agent_2.md | claude -p --dangerously-skip-permissions
   ```

### Task 3: エージェント3実行
1. summarizer_agent.mdの内容を読み取り、すべての<<ID>>を"3"に置換してagents/summarizer_agent_3.mdに保存してください
2. 次に以下のコマンドを実行してください：
   ```bash
   cat agents/summarizer_agent_3.md | claude -p --dangerously-skip-permissions
   ```

「3つのエージェントプロセスが並列完了しました」と表示してください。

## 要約結果収集

**生成された要約結果**:

{{summary_1}}を取得してください。
{{summary_2}}を取得してください。
{{summary_3}}を取得してください。

「=== 各エージェントの要約結果 ===」と表示してください。
「エージェント1: {{summary_1}}」と表示してください。
「エージェント2: {{summary_2}}」と表示してください。
「エージェント3: {{summary_3}}」と表示してください。

## アンサンブル判定実行

「=== アンサンブル判定開始 ===」と表示してください。

### ペア比較実行

**比較ペア1**: {{summary_1}}と{{summary_2}}を比較してください。
- 内容がほぼ同一（重要な事実が一致）の場合は「一致」
- 明らかに異なる事実が含まれる場合は「不一致」

比較結果を{{pair_12_match}}に保存してください（"一致"または"不一致"）。

**比較ペア2**: {{summary_2}}と{{summary_3}}を比較してください。
- 内容がほぼ同一（重要な事実が一致）の場合は「一致」
- 明らかに異なる事実が含まれる場合は「不一致」

比較結果を{{pair_23_match}}に保存してください（"一致"または"不一致"）。

**比較ペア3**: {{summary_1}}と{{summary_3}}を比較してください。
- 内容がほぼ同一（重要な事実が一致）の場合は「一致」
- 明らかに異なる事実が含まれる場合は「不一致」

比較結果を{{pair_13_match}}に保存してください（"一致"または"不一致"）。

### 判定結果表示

「ペア比較結果:」と表示してください。
「  (1,2): {{pair_12_match}}」と表示してください。
「  (2,3): {{pair_23_match}}」と表示してください。
「  (1,3): {{pair_13_match}}」と表示してください。

## 最終判定

{{pair_12_match}}、{{pair_23_match}}、{{pair_13_match}}の値に基づいて最終判定を行ってください：

### {{pair_12_match}}が"一致"の場合
{{summary_1}}を最終要約として採用してください。
「🎯 アンサンブル判定: エージェント1&2の要約を採用」と表示してください。
「📝 最終要約: {{summary_1}}」と表示してください。

### {{pair_23_match}}が"一致"の場合  
{{summary_2}}を最終要約として採用してください。
「🎯 アンサンブル判定: エージェント2&3の要約を採用」と表示してください。
「📝 最終要約: {{summary_2}}」と表示してください。

### {{pair_13_match}}が"一致"の場合
{{summary_1}}を最終要約として採用してください。
「🎯 アンサンブル判定: エージェント1&3の要約を採用」と表示してください。
「📝 最終要約: {{summary_1}}」と表示してください。

### すべてが"不一致"の場合
「🚨 アンサンブル判定: 一致する要約なし」と表示してください。
「⛔ 嘘検出により要約出力を阻止しました」と表示してください。
「💡 理由: すべてのエージェントが異なる内容を報告したため、信頼できる要約を特定できません」と表示してください。

## システム完了

「=== アンサンブル要約システム完了 ===」と表示してください。